{% extends 'base.html.twig' %}
{% block title %}Subscribe{% endblock %}
{% block body %}
<div class="row">
      <div class="col-12 col-md-12 mb-4">
         <form id="searchForm">
               <div class="input-group">
                  <input type="text" id="searchInput" class="form-control" placeholder="Search...">
                  <div class="input-group-append">
                     <button type="submit" class="btn btn-primary">Search</button>
                  </div>
               </div>
         </form>
      </div>
   </div>
<div class="container mt-4">
   {% if systemStatuses is empty %}
   <div class="alert alert-warning">There are no systems to subscribe to.</div>
   {% else %}
   {% if subscriptions is empty %}
   <div class="alert alert-warning">You are not subscribed to any systems.</div>
   {% else %}
   <h2 class="mb-3">My Subscriptions</h2>
   <div class="table-responsive">
      <table class="table border" id="table">
         <thead class="bg-light">
            <tr>
               <th scope="col">System</th>
               <th scope="col">Status</th>
               <th scope="col">Last Updated</th>
               {% if is_granted('ROLE_ADMIN') %}
               <th scope="col">Responsible Person</th>
               {% endif %}
               <th scope="col">Info</th>
            </tr>
         </thead>
         <tbody>
            {% for subscription in subscriptions|sort((a, b) => (a.systemStatus.status == 'Available') ? -1 : ((b.systemStatus.status == 'Available') ? 1 : (a.systemStatus.status == 'In progress') ? -1 : ((b.systemStatus.status == 'In progress') ? 1 : (a.systemStatus.status == 'Update') ? -1 : ((b.systemStatus.status == 'Update') ? 1 : (a.systemStatus.status == 'Down') ? -1 : ((b.systemStatus.status == 'Down') ? 1 : 0))))) %}
            <tr>
               <td>
                  <a href="{{ path('app_system_status_show', {'id': subscription.systemStatus.id}) }}">{{ subscription.systemStatus.system }}</a>
               </td>
               <td>
                  {% if subscription.systemStatus.status == 'Available' %}
                  <span class="badge bg-success text-white">Available</span>
                  {% elseif subscription.systemStatus.status == 'Maintenance' %}
                  <span class="badge bg-warning text-dark">Maintenance</span>
                  {% elseif subscription.systemStatus.status == 'Down' %}
                  <span class="badge bg-danger text-white">Down</span>
                  {% endif %}
               </td>
               <td>{{ subscription.systemStatus.updatedAt|date('Y-m-d H:i:s') }}</td>
               {% if is_granted('ROLE_ADMIN') %}
               <td>{{ subscription.systemStatus.responsible_person }}</td>
               {% endif %}
               <td>{{ subscription.systemStatus.info }}</td>
            </tr>
            {% endfor %}
         </tbody>
      </table>
   </div>
   {% endif %}
   {% endif %}
</div>
{# JavaScript Search file: /public/asset/js/search.js #}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Prevent form submission
        $('#searchForm').submit(function(event) {
            event.preventDefault();
        });

        // Filter table rows based on search query
        $('#searchInput').keyup(function() {
            var searchQuery = $(this).val().toLowerCase();
            $('#table tbody tr').each(function() {
                var system = $(this).find('td:first-child a').text().toLowerCase();
                var info = $(this).find('td:nth-child(3)').text().toLowerCase();
                if (system.includes(searchQuery) || info.includes(searchQuery)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });
    });
</script>
{% endblock %}